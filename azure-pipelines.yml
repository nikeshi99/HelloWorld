trigger: 
- main
pr: none
jobs:
- job: DockerBuild

  pool:
    vmImage: 'ubuntu-latest'
  variables:
    imageName: 'pipelines-hello-docker'
  steps:
  - task: Docker@2
    displayName: Login to ACR
    inputs:
      command: login
      containerRegistry: dockerRegistryServiceConnection1
  - task: Docker@2
    displayName: Login to Docker Hub
    inputs:
      command: login
      containerRegistry: dockerRegistryServiceConnection2
  - task: Docker@2
    displayName: 'Build and push Docker Image'
    inputs:
      repository: $(imageName)
      command: buildAndPush
      Dockerfile: 'Hello-world-service/Dockerfile'
      buildContext: '.'
      tags: |
        latest

  - script: |
      curl http://localhost:8080/greeting
